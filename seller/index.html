<!doctype html>

<head>
    <meta charset="utf-8">
    <title>2Close</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="favicon.ico">

    <!--Google Font link-->
    <link href="https://fonts.googleapis.com/css?family=Kanit" rel="stylesheet">


    <link rel="stylesheet" href="../assets/css/slick/slick.css">
    <link rel="stylesheet" href="../assets/css/slick/slick-theme.css">
    <link rel="stylesheet" href="../assets/css/animate.css">
    <link rel="stylesheet" href="../assets/css/iconfont.css">
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" href="../assets/css/magnific-popup.css">
    <link rel="stylesheet" href="../assets/css/bootsnav.css">
    <link rel="stylesheet" href="../assets/css/bootstrap-select.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="../assets/css/responsive.css" />

    <script src="../assets/js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
</head>

<body data-spy="scroll" data-target=".navbar-collapse">
    <!-- Preloader -->
    <div id="loading">
        <div id="loading-center">
            <div id="loading-center-absolute">
                <div class="object" id="object_one"></div>
                <div class="object" id="object_two"></div>
                <div class="object" id="object_three"></div>
                <div class="object" id="object_four"></div>
            </div>
        </div>
    </div>
    <!--End off Preloader -->

    <nav class="navbar">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>                        
                </button>
                <a class="navbar-brand" href="../index.html">
                    <img src="../assets/images/logo_yell.png">
                    <!--<img src="assets/images/footer-logo.png" class="logo logo-scrolled" alt="">-->
                </a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav hide-responsive">
                    <li><a href="#">หน้าสำรวจ</a></li>
                    <li><a>></a></li>
                    <li><a href="#">การขายของฉัน</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown" id="notification">

                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#"><i class="glyphicon glyphicon-th"></i> <span class="show-responsive">เมนู</span></a>
                        <ul class="dropdown-menu">
                            <li><a href="http://35529791-70-20180117142902.webstarterz.com/project3/seller/?status=all">การขายของฉัน</a></li>
                            <li><a href="http://35529791-70-20180117142902.webstarterz.com/project3/seller/product.html?status=all">สินค้าของฉัน</a></li>
                            <li><a href="http://35529791-70-20180117142902.webstarterz.com/project3/seller/income.html">รายรับของฉัน</a></li>
                        </ul>
                    </li>
                    <!--<li><a href="#"><i class="fa fa-sign-in"></i> Login</a></li>-->
                    <li class="dropdown">
                        <a class="dropdown-toggle" id="user" data-toggle="dropdown" href="#"></a>
                        <ul class="dropdown-menu">
                            <li class=""><a href="../userinfo/profile.html"><i class="fa fa-user-circle" aria-hidden="true"></i> User info</a></li>
                            <li class=""><a href="../seller/?status=all">Seller Mode</a></li>
                            <li><a id="logout-seller"><i class="fa fa-sign-out"></i> Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section id="submenu">
        <div class="container p-top-10">
            <ul>
                <li id="all"><a href="?status=all">ทั้งหมด</a></li>
                <li id="padding"><a href="?status=padding">ยังไม่ได้ชำระ</a></li>
                <li id="transpot"><a href="?status=transpot">ที่ต้องจัดส่ง</a></li>
                <li id="transpot_ok"><a href="?status=transpot_ok">การจัดส่ง</a></li>
                <li id="success"><a href="?status=success">สำเร็จแล้ว</a></li>
                <li id="cancel"><a href="?status=cancel">ยกเลิก</a></li>
                <li id="error"><a href="?status=error">การคืนเงิน/คืนสินค้า</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href=""><i class="fa-file-text-o fa"></i> ทำการจัดส่งเป็นชุด</a></li>
            </ul>
        </div>
    </section>

    <section id="search">
        <div class="container m-top-20">
            <div class="row">
                <!--
                    <div class="col-sm-3 col-xs-12 m-bottom-20">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="&#xf002; ค้นหาคำสั่งซื้อ" id="search-box">
                        </div>
                    </div>
                    <div class="col-sm-offset-1 col-sm-8 col-xs-12 date-box m-bottom-20">
                        <div class="col-sm-4 col-xs-4">วันที่ทำการสั่งซื้อ:</div>
                        <div class="col-sm-2 col-xs-2"><input type="text" id="start-date" class="form-control"></div>
                        <div class="left">-</div>
                        <div class="col-sm-2 col-xs-2"><input type="text" id="end-date" class="form-control"></div>
                        <div class="col-sm-3 col-xs-3"><button class="btn" type="button">ส่งออก</button></div>
                    </div>-->

                <div class="col-md-12 fix-box" id="order-data">
                </div>
            </div>
    </section>

    <footer>
        <div class="copyright m-top-20">
            <div class="container roomy-10">
                <div class="col-sm-12">
                    <i class="fa fa-copyright"></i> 2016 Sliapakorn University. All Rights Reserved.
                </div>
            </div>
        </div>
    </footer>
    <script src="../assets/js/vendor/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="../assets/js/moment.js"></script>
    <script type="text/javascript" src="../assets/js/transition.min.js"></script>
    <script type="text/javascript" src="../assets/js/collapse.js"></script>
    <script src="../assets/js/vendor/bootstrap.min.js"></script>
    <script src="../assets/js/bootstrap-datetimepicker.min.js"></script>
    <script src="../assets/js/bootstrap-select.js"></script>

    <script src="../assets/js/jquery.magnific-popup.js"></script>
    <script src="../assets/js/jquery.easing.1.3.js"></script>
    <script src="../assets/css/slick/slick.js"></script>
    <script src="../assets/css/slick/slick.min.js"></script>
    <script src="../assets/js/jquery.collapse.js"></script>
    <script src="../assets/js/bootsnav.js"></script>
    <script src="../assets/js/bootstrap-checkbox.min.js" defer></script>

    <script src="../assets/js/plugins.js"></script>
    <script src="../assets/js/main.js"></script>


    <script type="text/javascript">
        $('#start-date').datetimepicker({
            format: 'YYYY-MM-DD',
            defaultDate: moment()
        });
        $('#end-date').datetimepicker({
            format: 'YYYY-MM-DD',
            defaultDate: moment()
        });
        $("#start-date").on("dp.change", function(e) {
            $('#end-date').data("DateTimePicker").minDate(e.date);
        });
        $("#end-date").on("dp.change", function(e) {
            $('#start-date').data("DateTimePicker").minDate(e.date);
        });

        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;
            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };

        $(window).load(function() {
            IsLoginData();
            GetNotification();
            var status = getUrlParameter('status');
            $('#' + status).addClass('active');
            Number.prototype.format = function(n, x) {
                var re = '\\d(?=(\\d{' + (x || 3) + '})+' + (n > 0 ? '\\.' : '$') + ')';
                return this.toFixed(Math.max(0, ~~n)).replace(new RegExp(re, 'g'), '$&,');
            };

            $.ajax({
                type: "POST",
                url: 'http://35529791-70-20180117142902.webstarterz.com/project3/assets/service/service.php?action=getorder',
                data: {
                    status: status
                },
                success: function(data) {
                    var parsed = jQuery.parseJSON(data);
                    var text = "";
                    for (var i = 0; i < parsed.length; i++) {
                        text += '<div class="item">';
                        text += '<div class="top ">';
                        text += '<div class="left">' + parsed[i].account_username + '</div>';
                        text += '<div class="right">หมายเลขสั่งซื้อ ' + parsed[i].order_detail_id + '</div>';
                        text += '</div>';
                        text += '<div class="bottom fix-box">';
                        text += '<div class="col-sm-1 col-xs-1">';
                        text += '<img src="../' + parsed[i].product_pic + '">';
                        text += '<p>สินค้า ' + parsed[i].order_detail_amount + ' รายการ</p>';
                        text += '</div>';
                        text += '<div class="col-sm-3 col-xs-3">';
                        text += '<h4 class="text-black">' + parsed[i].product_name + '</h4>';
                        text += '</div>';
                        text += '<div class="col-sm-2 col-xs-2">';
                        product_price = parseInt(parsed[i].product_price);
                        text += '<h4>' + product_price.format() + '</h4>'; //text += '<h4>' + (parsed[i].product_price + parsed[i].product_price_mod) + '</h4>';
                        text += '<p>โอนผ่านบัญชีธนาคาร</p>';
                        text += '</div>';
                        text += '<div class="col-sm-2 col-xs-2">';
                        if (parsed[i].order_detail_status == 0) {
                            text += '<h3 class="text-danger">ยกเลิก';
                        } else if (parsed[i].order_detail_status == 1) {
                            text += '<h3 class="text-success">สำเร็จ';
                        } else if (parsed[i].order_detail_status == 2) {
                            text += '<h3 class="text-warning">ยังไม่ได้ชำระ';
                        } else if (parsed[i].order_detail_status == 3) {
                            text += '<h3 class="text-warning">รอการจัดส่ง';
                        } else if (parsed[i].order_detail_status == 4) {
                            text += '<h3 class="text-warning">จัดส่งแล้ว';
                        } else if (parsed[i].order_detail_status == 8) {
                            text += '<h3 class="text-danger">ยกเลิกโดยผู้ใช้งาน';
                        } else if (parsed[i].order_detail_status == 9) {
                            text += '<h3 class="text-danger">ยกเลิกโดยผู้ขาย';
                        }
                        text += '</h3></div>';
                        text += '<div class="col-sm-2 col-xs-2"><h3 class="text-black">' + parsed[i].type_drive_name + '</h3></div>';
                        text += '<div class="col-sm-1 col-xs-2">';
                        if (parsed[i].order_detail_status == 3)
                            text += '<input class="btn-popup" type="button" value="ยืนยันการจัดส่ง" onclick="tacking(\'' + parsed[i].order_detail_id + '\');">';
                        text += '</div>';
                        text += '</div>';
                        text += '</div>';
                    }

                    $('#order-data').append(text);
                }
            });
        });

        function tacking(orderindex) {
            var retVal = prompt("กรอกหมายเลข tacking : ", "");
            if (retVal != '') {
                $.ajax({
                    type: "POST",
                    url: 'http://35529791-70-20180117142902.webstarterz.com/project3/assets/service/service.php?action=updatetacking',
                    data: {
                        tackingnumber: retVal,
                        order_detail_id: orderindex
                    },
                    success: function(data) {
                        //alert(data);
                        if (data === 'OK') {
                            window.location.replace("http://35529791-70-20180117142902.webstarterz.com/project3/seller");
                        }
                    }
                });
            }
        }

        function IsLoginData() {
            $.ajax({
                type: "POST",
                url: 'http://35529791-70-20180117142902.webstarterz.com/project3/assets/service/service.php',
                success: function(data) {
                    if (data == -1) {
                        window.location.replace("http://35529791-70-20180117142902.webstarterz.com/project3/index.html");
                    }
                }
            });
        }

        function GetNotification() {
            $.ajax({
                type: "POST",
                url: 'http://35529791-70-20180117142902.webstarterz.com/project3/assets/service/service.php?action=getorder',
                data: {
                    status: "all"
                },
                success: function(data) {
                    //alert(data);
                    text = '<a class="dropdown-toggle" data-toggle="dropdown" href="#">';
                    text += '<i class="fa fa-square"><i class="fa fa-circle red"></i></i>'
                    text += ' <span class="show-responsive">แจ้งเตือน</span></a>';
                    text += '<ul class="dropdown-menu">'
                    var parsed = jQuery.parseJSON(data);
                    for (var i = 0; i < parsed.length; i++) {
                        if (parsed[i].order_detail_status == 1) {
                            text += "<li><a style='color:black;' href='http://35529791-70-20180117142902.webstarterz.com/project3/seller/?status=success'><p><i class='fa fa-check-circle'></i> ";
                            text += "ได้รับสินค้าเรียบร้อยแล้ว";
                        } else if (parsed[i].order_detail_status == 2) {
                            text += "<li><a style='color:black;' href='http://35529791-70-20180117142902.webstarterz.com/project3/seller/?status=padding'><p><i class='fa fa-info-circle'></i> ";
                            text += "มีคำสั่งซื้อใหม่";
                        } else if (parsed[i].order_detail_status == 3) {
                            text += "<li><a style='color:black;' href='http://35529791-70-20180117142902.webstarterz.com/project3/seller/?status=transpot'><p><i class='fa fa-money-bill'></i> ";
                            text += "รายการสั่งซื้อที่ชำระเงินแล้ว";
                        } else if (parsed[i].order_detail_status == 4) {
                            text += "<li><a style='color:black;' href='http://35529791-70-20180117142902.webstarterz.com/project3/seller/?status=transpot_ok'><p><i class='fa fa-truck'></i> ";
                            text += "คำสั่งซื้อที่ได้ทำการจัดส่งแล้ว";
                        }

                        text += " หมายเลขการสั่งซื้อ <span>" + parsed[i].order_detail_id + "</span> วันที่ <span>" + parsed[i].time + "</span>";
                        text += "</p></a></li>"
                    }
                    text += "</ul>"
                    $('#notification').append(text);
                }
            });
        }
    </script>
</body>

</html>